<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y.S Chat</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #6c757d;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
            --theme-color: #4361ee;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #e4e7ec 100%);
            transition: var(--transition);
        }
        
        .dark-theme {
            --bg-color: #1a1d28;
            --card-bg: #252a3a;
            --text-color: #f0f0f0;
            --text-secondary: #a0a0a0;
            --border-color: #3a3f4d;
            background-image: none !important;
            background-color: var(--bg-color) !important;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--primary-color);
        }
        
        .logo h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .theme-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .theme-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            font-weight: 500;
            box-shadow: var(--shadow);
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .theme-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }
        
        .panel {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 30px;
            transition: var(--transition);
        }
        
        .panel-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        input, select, button {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
            padding: 14px;
            border-radius: 8px;
            font-size: 1.1rem;
            transition: var(--transition);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn:disabled {
            background: var(--border-color);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: var(--error-color);
        }
        
        .btn-danger:hover {
            background: #d32f2f;
            box-shadow: 0 6px 15px rgba(244, 67, 54, 0.3); /* 红色阴影 */
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-success:hover {
            background: #388e3c;
        }
        
        .flex-container {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .flex-container > div {
            flex: 1;
        }
        
        .users-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .users-list li {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }
        
        .users-list li:last-child {
            border-bottom: none;
        }
        
        .users-list li:hover {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 8px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-status {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-color);
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message-sent {
            align-self: flex-end;
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .message-received {
            align-self: flex-start;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }
        
        .message-system {
            align-self: center;
            background: var(--warning-color);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            max-width: 100%;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            margin-top: 8px;
            opacity: 0.8;
        }
        
        .message-form {
            display: flex;
            gap: 10px;
        }
        
        .message-form input {
            flex: 1;
        }
        
        .message-form button {
            width: auto;
            min-width: 100px;
        }
        
        .status-bar {
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 20px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--error-color);
        }
        
        .connected .status-dot {
            background: var(--success-color);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow);
            z-index: 10000; /* 提高层级 */
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: var(--success-color);
        }
        
        .notification.error {
            background: var(--error-color);
        }
        
        .notification.info {
            background: var(--info-color);
        }
        
        .notification.warning {
            background: var(--warning-color);
        }
        
        #serverPanel {
            transition: height 0.3s ease, opacity 0.3s ease;
            overflow: hidden;
        }
        
        #serverPanel.hidden {
            height: 0;
            opacity: 0;
            margin: 0;
            padding: 0;
            border: none;
        }
        
        #settingsPanel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100%;
            background: var(--card-bg);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            z-index: 1001;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        #settingsPanel.show {
            transform: translateX(-450px);
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .settings-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .color-options {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .color-option:hover, .color-option.active {
            transform: scale(1.1);
            border-color: var(--text-color);
        }
        
        .custom-color-panel {
            margin-top: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            display: none;
        }
        
        .custom-color-panel.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .custom-color-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .custom-color-input input {
            flex: 1;
            height: 40px;
        }
        
        .custom-color-input button {
            width: auto;
            min-width: 80px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
        
        .message-container {
            display: flex;
            flex-direction: column;
            max-width: 80%;
            margin-bottom: 15px;
        }
        
        .message-container.sent {
            align-self: flex-end;
        }
        
        .message-container.received {
            align-self: flex-start;
        }
        
        .message-sender {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 2px 8px;
        }
        
        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        .sent .message-bubble {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .received .message-bubble {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }
        
        .message-time {
            font-size: 0.7rem;
            text-align: right;
            margin-top: 4px;
            opacity: 0.7;
        }
        
        #connectPanel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100%;
            background: var(--card-bg);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
            z-index: 1002;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        #connectPanel.show {
            transform: translateX(-450px);
        }
        
        .connect-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .connect-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .login-panel {
            background: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        
        .login-panel h2 {
            font-size: 2rem;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: var(--primary-color);
        }
        
        .login-panel .logo {
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .login-panel .logo h1 {
            font-size: 2.5rem;
        }
        
        .login-panel .form-group {
            margin-bottom: 25px;
        }
        
        .login-panel .btn {
            font-size: 1.2rem;
            padding: 15px;
        }
        
        /* 全屏模式样式 - 优化部分 */
        .fullscreen-chat {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 3000;
            background: var(--card-bg);
            display: none;
            flex-direction: column;
            padding: 20px;
            background: inherit; /* 继承body背景 */
        }
        
        .fullscreen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .fullscreen-title {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
        }
        
        .fullscreen-controls {
            display: flex;
            gap: 10px;
        }
        
        .fullscreen-controls .btn {
            width: auto;
            padding: 10px 15px;
        }
        
        .fullscreen-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .fullscreen-form {
            display: flex;
            gap: 10px;
        }
        
        .fullscreen-form input {
            flex: 1;
        }
        
        .fullscreen-form button {
            width: auto;
            min-width: 100px;
        }
        
        /* 优化退出全屏按钮 */
        #exitFullscreenBtn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #exitFullscreenBtn:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }
        
        #exitFullscreenBtn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.4);
        }
        
        /* 全屏设置按钮 */
        #fullscreenSettingsBtn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            background: var(--info-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #fullscreenSettingsBtn:hover {
            background: #0b7dda;
            transform: scale(1.1);
        }
        
        /* 被踢出全屏界面 */
        .kicked-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        .kicked-overlay h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .kicked-overlay p {
            font-size: 1.5rem;
        }
        
        @media (max-width: 900px) {
            .flex-container {
                flex-direction: column;
            }
            
            .chat-container {
                height: 500px;
            }
            
            #settingsPanel, #connectPanel {
                width: 380px;
            }
            
            #settingsPanel.show, #connectPanel.show {
                transform: translateX(-380px);
            }
        }
        
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .theme-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .panel {
                padding: 20px;
            }
            
            .chat-container {
                height: 400px;
            }
            
            .message-container {
                max-width: 90%;
            }
            
            #settingsPanel, #connectPanel {
                width: 100%;
                right: -100%;
                transform: none;
            }
            
            #settingsPanel.show, #connectPanel.show {
                right: 0;
                transform: none;
            }
            
            .login-panel {
                padding: 25px;
            }
            
            .login-panel h2 {
                font-size: 1.5rem;
            }
            
            .fullscreen-controls {
                flex-direction: row;
            }
            
            .kicked-overlay h1 {
                font-size: 2rem;
            }
            
            .kicked-overlay p {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-panel">
            <div class="logo">
                <i class="fas fa-server"></i>
                <h1>登录到 Y.Server</h1>
            </div>
            <div class="form-group">
                <label for="loginServerUrl">服务器地址</label>
                <input type="text" id="loginServerUrl" placeholder="请输入服务器WebSocket地址">
            </div>
            <div class="form-group">
                <label for="loginUsername">昵称</label>
                <input type="text" id="loginUsername" placeholder="请输入你的昵称">
            </div>
            <button class="btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i>
                进入
            </button>
        </div>
    </div>
    
    <!-- 主页面容器 -->
    <div class="container" id="mainContainer" style="display: none;">
        <header>
            <div class="logo">
                <i class="fas fa-comments"></i>
                <h1>Y.Server Chat</h1>
            </div>
            <div class="theme-controls">
                <button class="theme-btn" id="connectBtnHeader">
                    <i class="fas fa-plug"></i>
                    <span>连接</span>
                </button>
                <button class="theme-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                    <span>设置</span>
                </button>
                <button class="theme-btn" id="fullscreenBtn">
                    <i class="fas fa-expand"></i>
                    <span>全屏</span>
                </button>
            </div>
        </header>
        
        <div class="flex-container">
            <div class="panel">
                <h2 class="panel-title">
                    <i class="fas fa-users"></i>
                    在线用户 (<span id="userCount">0</span>)
                </h2>
                <ul class="users-list" id="usersList">
                    <li>连接服务器后显示在线用户</li>
                </ul>
            </div>
            
            <div class="panel">
                <h2 class="panel-title">
                    <i class="fas fa-comment-dots"></i>
                    聊天室
                </h2>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- 初始欢迎消息由JS添加 -->
                    </div>
                    <div class="message-form">
                        <input type="text" id="messageInput" placeholder="输入消息..." disabled>
                        <button class="btn" id="sendBtn" disabled>
                            <i class="fas fa-paper-plane"></i>
                            发送
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="connection-status" id="connectionStatus">
                <div class="status-dot"></div>
                <span>未连接</span>
            </div>
            <div id="connectionInfo">
                请连接服务器
            </div>
        </div>
    </div>
    
    <!-- 全屏聊天模式 - 优化后 -->
    <div class="fullscreen-chat" id="fullscreenChat">
        <div class="fullscreen-header">
            <div class="fullscreen-title">
                <i class="fas fa-comments"></i>
                <span>Y.S Chat</span>
            </div>
            <div class="fullscreen-controls">
                <button class="btn" id="fullscreenSettingsBtn" title="设置">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn" id="exitFullscreenBtn" title="退出全屏模式">
                    <i class="fas fa-compress"></i>
                </button>
            </div>
        </div>
        <div class="fullscreen-messages" id="fullscreenMessages"></div>
        <div class="fullscreen-form">
            <input type="text" id="fullscreenInput" placeholder="输入消息...">
            <button class="btn" id="fullscreenSendBtn">
                <i class="fas fa-paper-plane"></i>
                发送
            </button>
        </div>
    </div>
    
    <!-- 被踢出界面 -->
    <div id="kickedOverlay" class="kicked-overlay">
        <h1>你已被踢出</h1>
        <p><span id="countdown">10</span>秒后网页自动刷新</p>
    </div>
    
    <div class="overlay" id="overlay"></div>
    
    <!-- 连接服务器面板 -->
    <div id="connectPanel">
        <div class="connect-header">
            <h2><i class="fas fa-plug"></i></h2>
            <button class="connect-close" id="closeConnect">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="panel">
            <div class="form-group">
                <label for="serverUrl">服务器地址</label>
                <input type="text" id="serverUrl" placeholder="请输入WebSocket服务器地址">
            </div>
            <div class="form-group">
                <label for="username">昵称</label>
                <input type="text" id="username" placeholder="请输入你的昵称">
            </div>
            <button class="btn" id="connectBtn">
                <i class="fas fa-plug"></i>
                连接服务器
            </button>
        </div>
    </div>
    
    <!-- 设置面板 -->
    <div id="settingsPanel">
        <div class="settings-header">
            <h2><i class="fas fa-cog"></i></h2>
            <button class="settings-close" id="closeSettings">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">
                <i class="fas fa-user-edit"></i>
                更改昵称
            </h2>
            <div class="form-group">
                <label for="newUsername">新昵称</label>
                <input type="text" id="newUsername" placeholder="输入新的昵称">
            </div>
            <button class="btn" id="changeNameBtn">
                <i class="fas fa-signature"></i>
                更改昵称
            </button>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">
                <i class="fas fa-palette"></i>
                主题设置
            </h2>
            <button class="btn" id="themeToggle">
                <span id="themeText">深色模式：关</span>
            </button>
            
            <div class="form-group" style="margin-top: 20px;">
                <label>主题颜色</label>
                <div class="color-options">
                    <div class="color-option" style="background: #4361ee;" data-color="#4361ee"></div>
                    <div class="color-option" style="background: #4caf50;" data-color="#4caf50"></div>
                    <div class="color-option" style="background: #f44336;" data-color="#f44336"></div>
                    <div class="color-option" style="background: #ff9800;" data-color="#ff9800"></div>
                    <div class="color-option" style="background: #9c27b0;" data-color="#9c27b0"></div>
                    <div class="color-option" id="customColorTrigger" style="background: #6c757d;">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>
                
                <!-- 自定义颜色面板 -->
                <div class="custom-color-panel" id="customColorPanel">
                    <label for="customColorInput">自定义颜色</label>
                    <div class="custom-color-input">
                        <input type="color" id="customColorInput">
                        <button class="btn" id="applyCustomColor">
                            <i class="fas fa-check"></i>
                            应用
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">
                <i class="fas fa-image"></i>
                背景设置
            </h2>
            <div class="form-group">
                <label for="bgImage">背景图片</label>
                <input type="file" id="bgImage" accept="image/*">
            </div>
            <button class="btn btn-danger" id="resetBgBtn">
                <i class="fas fa-trash"></i>
                重置背景
            </button>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <script>
        // DOM元素
        const connectBtn = document.getElementById('connectBtn');
        const connectBtnHeader = document.getElementById('connectBtnHeader');
        const sendBtn = document.getElementById('sendBtn');
        const changeNameBtn = document.getElementById('changeNameBtn');
        const themeToggle = document.getElementById('themeToggle');
        const themeText = document.getElementById('themeText');
        const settingsBtn = document.getElementById('settingsBtn');
        const closeSettings = document.getElementById('closeSettings');
        const closeConnect = document.getElementById('closeConnect');
        const serverUrlInput = document.getElementById('serverUrl');
        const usernameInput = document.getElementById('username');
        const newUsernameInput = document.getElementById('newUsername');
        const messageInput = document.getElementById('messageInput');
        const chatMessages = document.getElementById('chatMessages');
        const usersList = document.getElementById('usersList');
        const userCount = document.getElementById('userCount');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionInfo = document.getElementById('connectionInfo');
        const notification = document.getElementById('notification');
        const settingsPanel = document.getElementById('settingsPanel');
        const connectPanel = document.getElementById('connectPanel');
        const overlay = document.getElementById('overlay');
        const bgImageInput = document.getElementById('bgImage');
        const colorOptions = document.querySelectorAll('.color-option');
        const resetBgBtn = document.getElementById('resetBgBtn');
        const loginOverlay = document.getElementById('loginOverlay');
        const mainContainer = document.getElementById('mainContainer');
        const loginBtn = document.getElementById('loginBtn');
        const loginServerUrlInput = document.getElementById('loginServerUrl');
        const loginUsernameInput = document.getElementById('loginUsername');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
        const fullscreenChat = document.getElementById('fullscreenChat');
        const fullscreenMessages = document.getElementById('fullscreenMessages');
        const fullscreenInput = document.getElementById('fullscreenInput');
        const fullscreenSendBtn = document.getElementById('fullscreenSendBtn');
        const fullscreenSettingsBtn = document.getElementById('fullscreenSettingsBtn');
        const customColorTrigger = document.getElementById('customColorTrigger');
        const customColorPanel = document.getElementById('customColorPanel');
        const customColorInput = document.getElementById('customColorInput');
        const applyCustomColor = document.getElementById('applyCustomColor');
        const kickedOverlay = document.getElementById('kickedOverlay');
        const countdownElement = document.getElementById('countdown');
        
        // WebSocket连接
        let socket = null;
        let connected = false;
        let userId = null;
        let username = '';
        let countdownInterval = null;
        
        // 登录按钮事件
        loginBtn.addEventListener('click', () => {

            // 协议转换
            let serverUrl = loginServerUrlInput.value.trim();
            if (serverUrl.startsWith('https://')) {
                serverUrl = serverUrl.replace('https://', 'wss://');
            }

            username = loginUsernameInput.value.trim();
            
            if (!serverUrl) {
                showNotification('请输入服务器地址', 'error');
                return;
            }
            
            if (!username) {
                showNotification('请输入昵称', 'error');
                return;
            }
            
            // 保存用户名
            localStorage.setItem('username', username);
            
            // 填充到主页面
            serverUrlInput.value = serverUrl;
            usernameInput.value = username;
            
            // 显示主页面，隐藏登录页面
            loginOverlay.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // 尝试连接
            connect();
        });
        
        // 连接/断开服务器
        connectBtn.addEventListener('click', () => {
            if (connected) {
                disconnect();
            } else {
                connect();
            }
        });
        
        // 标题栏的连接按钮
        connectBtnHeader.addEventListener('click', () => {
            connectPanel.classList.add('show');
            overlay.classList.add('show');
        });
        
        // 发送消息
        sendBtn.addEventListener('click', sendMessage);
        
        // 发送消息（按回车键）
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // 全屏发送消息
        fullscreenInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                fullscreenSendMessage();
            }
        });
        
        fullscreenSendBtn.addEventListener('click', fullscreenSendMessage);
        
        // 更改昵称
        changeNameBtn.addEventListener('click', () => {
            const newName = newUsernameInput.value.trim();
            if (newName && newName !== username) {
                // 保存新用户名
                localStorage.setItem('username', newName);
                sendCommand('rename', { name: newName });
            }
        });
        
        // 打开设置面板
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.add('show');
            overlay.classList.add('show');
        });
        
        // 全屏模式设置按钮
        fullscreenSettingsBtn.addEventListener('click', () => {
            // 退出全屏
            fullscreenChat.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // 打开设置面板
            settingsPanel.classList.add('show');
            overlay.classList.add('show');
        });
        
        // 关闭设置面板
        closeSettings.addEventListener('click', closePanels);
        closeConnect.addEventListener('click', closePanels);
        overlay.addEventListener('click', closePanels);
        
        function closePanels() {
            settingsPanel.classList.remove('show');
            connectPanel.classList.remove('show');
            overlay.classList.remove('show');
        }
        
        // 切换深色/浅色模式
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            
            if (document.body.classList.contains('dark-theme')) {
                themeText.textContent = '深色模式：开';
                localStorage.setItem('darkMode', 'true');
            } else {
                themeText.textContent = '深色模式：关';
                localStorage.setItem('darkMode', 'false');
            }
            
            showNotification(`已切换至${themeText.textContent}`, 'success');
        });
        
        // 更换主题颜色
        colorOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                // 防止点击自定义颜色触发按钮时触发颜色选项
                if (option.id === 'customColorTrigger') return;
                
                const color = option.getAttribute('data-color');
                applyThemeColor(color);
                showNotification('主题颜色已更换', 'success');
            });
        });
        
        // 自定义颜色触发器
        customColorTrigger.addEventListener('click', () => {
            customColorPanel.classList.toggle('show');
        });
        
        // 应用自定义颜色
        applyCustomColor.addEventListener('click', () => {
            const color = customColorInput.value;
            applyThemeColor(color);
            customColorPanel.classList.remove('show');
            showNotification('自定义颜色已应用', 'success');
        });
        
        // 应用主题颜色
        function applyThemeColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            
            // 计算并设置较深的颜色作为次要颜色
            const darkerColor = adjustColor(color, -20);
            document.documentElement.style.setProperty('--secondary-color', darkerColor);
            
            localStorage.setItem('themeColor', color);
            
            // 更新按钮上的颜色
            const buttons = document.querySelectorAll('.btn:not(.btn-danger):not(.btn-success)');
            buttons.forEach(btn => {
                btn.style.background = color;
            });
            
            // 更新浅色模式背景（如果没有背景图片）
            if (!localStorage.getItem('bgImage') && !document.body.classList.contains('dark-theme')) {
                document.body.style.backgroundImage = `linear-gradient(135deg, ${color}20 0%, ${darkerColor}20 100%)`;
            }
        }
        
        // 辅助函数：调整颜色亮度
        function adjustColor(hex, percent) {
            hex = hex.replace(/^#/, '');
            let r = parseInt(hex.substring(0, 2), 16);
            let g = parseInt(hex.substring(2, 4), 16);
            let b = parseInt(hex.substring(4, 6), 16);
            
            r = Math.min(255, Math.max(0, r + r * percent / 100));
            g = Math.min(255, Math.max(0, g + g * percent / 100));
            b = Math.min(255, Math.max(0, b + b * percent / 100));
            
            return `#${Math.round(r).toString(16).padStart(2, '0')}${Math.round(g).toString(16).padStart(2, '0')}${Math.round(b).toString(16).padStart(2, '0')}`;
        }
        
        // 更换背景图片
        bgImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.body.style.backgroundImage = `url(${event.target.result})`;
                    document.body.style.backgroundSize = 'cover';
                    document.body.style.backgroundAttachment = 'fixed';
                    localStorage.setItem('bgImage', event.target.result);
                    showNotification('背景图片已更换', 'success');
                };
                reader.readAsDataURL(file);
            }
        });
        
        // 重置背景
        resetBgBtn.addEventListener('click', () => {
            document.body.style.backgroundImage = '';
            localStorage.removeItem('bgImage');
            showNotification('背景已重置', 'success');
        });
        
        // 进入全屏模式
        fullscreenBtn.addEventListener('click', () => {
            fullscreenChat.style.display = 'flex';
            mainContainer.style.display = 'none';
            
            // 确保全屏容器滚动到底部
            fullscreenMessages.scrollTop = fullscreenMessages.scrollHeight;
            
            // 聚焦输入框
            fullscreenInput.focus();
        });
        
        // 退出全屏模式
        exitFullscreenBtn.addEventListener('click', () => {
            fullscreenChat.style.display = 'none';
            mainContainer.style.display = 'block';
            
            // 确保主容器滚动到底部
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
        
        // 全屏发送消息
        function fullscreenSendMessage() {
            const message = fullscreenInput.value.trim();
            if (!message || !socket) return;
            
            const data = {
                type: 'message',
                content: message
            };
            
            socket.send(JSON.stringify(data));
            // 立即显示自己发送的消息
            addMessage(username, message, 'sent');
            fullscreenInput.value = '';
            fullscreenInput.focus();
        }
        
        // 连接服务器
        function connect() {
            let serverUrl = serverUrlInput.value.trim();
            if (serverUrl.startsWith('https://')) {
                serverUrl = serverUrl.replace('https://', 'wss://');
            }
            username = usernameInput.value.trim();
            
            if (!serverUrl) {
                showNotification('请输入服务器地址', 'error');
                return;
            }
            
            if (!username) {
                showNotification('请输入昵称', 'error');
                return;
            }
            
            try {
                socket = new WebSocket(serverUrl);
                
                socket.addEventListener('open', () => {
                    connected = true;
                    updateUI();
                    showNotification('已连接到服务器', 'success');
                    
                    connectionStatus.classList.add('connected');
                    connectionStatus.querySelector('span').textContent = '已连接';
                    connectionInfo.textContent = `服务器: ${serverUrl}`;
                    
                    connectBtn.innerHTML = '<i class="fas fa-plug"></i> 断开连接';
                    
                    // 发送初始昵称设置
                    sendCommand('rename', { name: username });
                    
                    // 关闭连接面板
                    closePanels();
                });
                
                socket.addEventListener('message', handleMessage);
                
                socket.addEventListener('close', (event) => {
                    connected = false;
                    updateUI();
                    
                    // 检查是否被踢出
                    if (event.reason === 'Kicked by server') {
                        // 显示被踢出界面
                        showKickedOverlay();
                    } else {
                        showNotification('已断开服务器连接', 'warning');
                    }
                    
                    connectionStatus.classList.remove('connected');
                    connectionStatus.querySelector('span').textContent = '未连接';
                    connectionInfo.textContent = '请连接服务器';
                    
                    connectBtn.innerHTML = '<i class="fas fa-plug"></i> 连接服务器';
                });
                
                socket.addEventListener('error', () => {
                    showNotification('连接服务器失败', 'error');
                });
            } catch (error) {
                showNotification(`连接错误: ${error.message}`, 'error');
            }
        }
        
        // 断开连接
        function disconnect() {
            if (socket) {
                socket.close();
                socket = null;
            }
            connected = false;
            updateUI();
        }
        
        // 显示被踢出界面
        function showKickedOverlay() {
            // 隐藏所有其他界面
            mainContainer.style.display = 'none';
            fullscreenChat.style.display = 'none';
            loginOverlay.style.display = 'none';
            
            // 显示被踢出界面
            kickedOverlay.style.display = 'flex';
            
            // 开始倒计时
            let countdown = 10;
            countdownElement.textContent = countdown;
            
            // 清除之前的倒计时（如果有）
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    window.location.reload();
                }
            }, 1000);
        }
        
        // 处理服务器消息
        function handleMessage(event) {
            try {
                const data = JSON.parse(event.data);
                
                switch (data.type) {
                    case 'welcome':
                        userId = data.your_id;
                        addSystemMessage(data.message);
                        updateUserList(data.users);
                        break;
                        
                    case 'userlist':
                        updateUserList(data.users);
                        break;
                        
                    case 'message':
                        // 不显示自己发送的消息（已经在发送时显示过了）
                        if (data.sender !== userId) {
                            addMessage(data.sender_name, data.message, 'received');
                        }
                        break;
                        
                    case 'system':
                        addSystemMessage(data.message);
                        break;
                }
            } catch (error) {
                console.error('解析消息错误:', error);
            }
        }
        
        // 发送消息
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || !socket) return;
            
            const data = {
                type: 'message',
                content: message
            };
            
            socket.send(JSON.stringify(data));
            // 立即显示自己发送的消息
            addMessage(username, message, 'sent');
            messageInput.value = '';
            messageInput.focus();
        }
        
        // 发送命令
        function sendCommand(type, payload = {}) {
            if (!socket) return;
            
            const data = {
                type: type,
                ...payload
            };
            
            socket.send(JSON.stringify(data));
        }
        
        // 添加消息到聊天框（同时更新两个视图）
        function addMessage(sender, text, type) {
            // 为主聊天窗口添加消息
            addMessageToContainer(sender, text, type, chatMessages);
            
            // 为全屏聊天窗口添加消息
            addMessageToContainer(sender, text, type, fullscreenMessages);
        }
        
        // 添加消息到指定容器
        function addMessageToContainer(sender, text, type, container) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container', type);
            
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageContainer.innerHTML = `
                <div class="message-sender">${sender}</div>
                <div class="message-bubble">
                    <div class="message-text">${text}</div>
                    <div class="message-time">${timestamp}</div>
                </div>
            `;
            
            container.appendChild(messageContainer);
            container.scrollTop = container.scrollHeight;
        }
        
        // 添加系统消息（同时更新两个视图）
        function addSystemMessage(text) {
            // 为主聊天窗口添加系统消息
            addSystemMessageToContainer(text, chatMessages);
            
            // 为全屏聊天窗口添加系统消息
            addSystemMessageToContainer(text, fullscreenMessages);
        }
        
        // 添加系统消息到指定容器
        function addSystemMessageToContainer(text, container) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'message-system');
            messageElement.textContent = text;
            
            container.appendChild(messageElement);
            container.scrollTop = container.scrollHeight;
        }
        
        // 更新用户列表
        function updateUserList(users) {
            usersList.innerHTML = '';
            userCount.textContent = users.length;
            
            if (users.length === 0) {
                const item = document.createElement('li');
                item.textContent = '暂无在线用户';
                usersList.appendChild(item);
                return;
            }
            
            users.forEach(user => {
                const item = document.createElement('li');
                const firstLetter = user.name.charAt(0).toUpperCase();
                
                // 确保状态有默认值
                const status = user.status || '在线';
                
                item.innerHTML = `
                    <div class="user-avatar">${firstLetter}</div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-status">
                            <span class="status-indicator"></span>
                            ${status}
                        </div>
                    </div>
                `;
                
                usersList.appendChild(item);
            });
        }
        
        // 更新UI状态
        function updateUI() {
            messageInput.disabled = !connected;
            sendBtn.disabled = !connected;
            newUsernameInput.disabled = !connected;
            fullscreenInput.disabled = !connected;
            fullscreenSendBtn.disabled = !connected;
        }
        
        // 显示通知
        function showNotification(text, type) {
            notification.textContent = text;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000); // 显示7秒
        }
        
        // 加载保存的设置
        function loadSettings() {
            // 加载深色模式设置
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.body.classList.add('dark-theme');
                themeText.textContent = '深色模式：开';
            } else {
                themeText.textContent = '深色模式：关';
            }
            
            // 加载主题颜色
            const themeColor = localStorage.getItem('themeColor');
            if (themeColor) {
                applyThemeColor(themeColor);
            }
            
            // 加载背景图片
            const bgImage = localStorage.getItem('bgImage');
            if (bgImage) {
                document.body.style.backgroundImage = `url(${bgImage})`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
            }
            
            // 加载用户名
            const savedUsername = localStorage.getItem('username');
            if (savedUsername) {
                loginUsernameInput.value = savedUsername;
                usernameInput.value = savedUsername;
            }
        }
        
        // 初始化
        function init() {
            // 设置默认服务器地址提示
            serverUrlInput.placeholder = '例如: ws://localhost:8765';
            loginServerUrlInput.placeholder = '例如: ws://localhost:8765';
            updateUI();
            
            // 添加初始欢迎消息
            addSystemMessage('欢迎加入Y.S Chat！连接服务器后开始聊天');
            
            // 生成随机昵称
            const nouns = ['用户', '访客', '成员', '朋友'];
            const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
            const randomNumber = Math.floor(Math.random() * 90) + 10;
            
            // 优先使用保存的用户名
            const savedUsername = localStorage.getItem('username');
            if (!savedUsername) {
                loginUsernameInput.value = `${randomNoun}${randomNumber}`;
                usernameInput.value = `${randomNoun}${randomNumber}`;
            }
            
            // 加载保存的设置
            loadSettings();
        }
        
        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>